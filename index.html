<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, getDocs, query, orderBy, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCx30_dsjjFJW8FgXyVBI5VkTE5k6Dc8qQ",
            authDomain: "sports-management-system-1ce0e.firebaseapp.com",
            databaseURL: "https://sports-management-system-1ce0e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sports-management-system-1ce0e",
            storageBucket: "sports-management-system-1ce0e.firebasestorage.app",
            messagingSenderId: "110723728337",
            appId: "1:110723728337:web:1c200d0992cb84df3f16f0",
            measurementId: "G-Q79K6G29FN"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.firestore = { collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, getDocs, query, orderBy, setDoc };
        window.isFirebaseReady = true;
        
        // Initialize data when Firebase is ready
        setTimeout(() => {
            if (window.initializeFirebaseData) {
                window.initializeFirebaseData();
            }
        }, 1000);
    </script>
    
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Anuphan', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 25%, #0ea5e9 50%, #38bdf8 75%, #7dd3fc 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        .active-nav {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
        }
        .sport-card {
            background: linear-gradient(45deg, #3b82f6, #1e40af);
        }
        .team-card {
            background: linear-gradient(45deg, #0ea5e9, #0284c7);
        }
        .firebase-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .firebase-connected {
            background: #10b981;
            color: white;
        }
        .firebase-disconnected {
            background: #ef4444;
            color: white;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Firebase Status Indicator -->
    <div id="firebaseStatus" class="firebase-status firebase-disconnected">
        <i class="fas fa-circle mr-1"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="bg-white/20 backdrop-blur-md rounded-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trophy text-4xl text-blue-600"></i>
                </div>
                <h2 class="text-white text-2xl font-bold mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <p class="text-white/80">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</p>
                <p class="text-white/60 text-sm mt-2">üî• ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-white text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                </div>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-sign-in-alt mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
                
                <button type="button" onclick="guestLogin()" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-eye mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-white/60 text-sm">Admin: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ | ‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="bg-white/10 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center">
                        <i class="fas fa-trophy text-2xl text-purple-600"></i>
                    </div>
                    <div>
                        <h1 class="text-white text-xl md:text-2xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</h1>
                        <p class="text-white/80 text-sm">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-white text-right">
                        <p class="text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span id="currentUser">Admin</span></p>
                        <p class="text-xs text-white/70">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: <span id="loginTime">10:30 ‡∏ô.</span></p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="bg-blue-500/20 hover:bg-blue-500/30 text-white px-3 py-2 rounded-lg transition-all text-sm admin-only" onclick="checkSystemStatus()" title="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö">
                            <i class="fas fa-stethoscope"></i>
                        </button>
                        <button class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all" onclick="logout()">
                            <i class="fas fa-sign-out-alt mr-2"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-md border-b border-white/20">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center md:justify-start space-x-2 md:space-x-6 py-3">
                <button class="nav-item active-nav text-white px-4 py-2 text-sm md:text-base" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line mr-2"></i>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <button id="unityNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('unity')">
                    <i class="fas fa-heart mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
                </button>
                <button id="teamsNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('teams')">
                    <i class="fas fa-users mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                </button>
                <button id="exportNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('export')">
                    <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Stats Cards -->
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-white text-3xl font-bold" id="totalTeams">4</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                            <p class="text-white text-3xl font-bold" id="avgScore">1002.5</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                            <p class="text-white text-3xl font-bold" id="maxScore">1030</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-trophy text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-white text-3xl font-bold" id="totalRecords">4</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-list text-white text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unity Score Chart and Ranking -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6">
                    <h3 class="text-white text-xl font-bold mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</h3>
                    <canvas id="unityChart" width="400" height="300"></canvas>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6">
                    <h3 class="text-white text-xl font-bold mb-4">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</h3>
                    <div id="unityRanking" class="space-y-4">
                        <!-- Unity ranking will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Teams Management Section -->
        <div id="teams" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-white text-2xl font-bold mb-4 md:mb-0">
                        <i class="fas fa-users mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                    </h2>
                    <button class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-3 rounded-lg transition-all admin-only" onclick="showAddTeamModal()">
                        <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                    </button>
                </div>

                <div id="teamsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Teams will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Unity Score Section -->
        <div id="unity" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-heart mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
                </h2>
                
                <!-- Add/Deduct Score Buttons -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-green-500/20 rounded-xl p-6 border border-green-500/30">
                        <h3 class="text-white text-lg font-bold mb-4">
                            <i class="fas fa-plus-circle mr-2 text-green-400"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                        </h3>
                        <form id="addScoreForm" class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                                <select id="addTeamSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°</label>
                                <input type="number" id="addScore" min="1" max="100" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="1-100">
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</label>
                                <textarea id="addNotes" rows="2" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg transition-all">
                                <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                            </button>
                        </form>
                    </div>

                    <div class="bg-red-500/20 rounded-xl p-6 border border-red-500/30">
                        <h3 class="text-white text-lg font-bold mb-4">
                            <i class="fas fa-minus-circle mr-2 text-red-400"></i>‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                        </h3>
                        <form id="deductScoreForm" class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                                <select id="deductTeamSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å</label>
                                <input type="number" id="deductScore" min="1" max="100" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1-100">
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</label>
                                <textarea id="deductNotes" rows="2" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg transition-all">
                                <i class="fas fa-minus mr-2"></i>‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Unity Score History -->
                <div class="bg-white/10 rounded-xl p-6">
                    <h3 class="text-white text-lg font-bold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left py-3 px-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="text-left py-3 px-4">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</th>
                                    <th class="text-center py-3 px-4">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th class="text-center py-3 px-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                    <th class="text-left py-3 px-4">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                                    <th class="text-center py-3 px-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="unityHistoryTable">
                                <!-- Unity history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div id="export" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-download mr-3"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="team-card rounded-xl p-6 text-white card-hover">
                        <div class="text-center">
                            <i class="fas fa-file-pdf text-6xl mb-4 text-red-400"></i>
                            <h3 class="text-xl font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</h3>
                            <p class="text-white/80 mb-4">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö PDF</p>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition-all w-full" onclick="exportPDF()">
                                <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF
                            </button>
                        </div>
                    </div>

                    <div class="team-card rounded-xl p-6 text-white card-hover">
                        <div class="text-center">
                            <i class="fas fa-file-excel text-6xl mb-4 text-green-400"></i>
                            <h3 class="text-xl font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel</h3>
                            <p class="text-white/80 mb-4">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Excel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
                            <button class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-all w-full" onclick="exportExcel()">
                                <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-8 bg-white/10 rounded-xl p-6">
                    <h3 class="text-white text-lg font-bold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-white font-medium mb-3">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</h4>
                            <div id="exportSummary" class="space-y-2">
                                <!-- Export summary will be loaded here -->
                            </div>
                        </div>
                        <div>
                            <h4 class="text-white font-medium mb-3">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>
                            <div class="space-y-2 text-white/80 text-sm">
                                <p>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="addCount" class="text-green-400 font-bold">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                <p>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="deductCount" class="text-red-400 font-bold">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                <p>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalCount" class="text-white font-bold">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/10 backdrop-blur-md border-t border-white/20 mt-16">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-white">
                <p>&copy; 2025 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</p>
                <p class="text-white/70 text-sm mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase</p>
            </div>
        </div>
    </footer>
    </div> <!-- End Main App -->

    <script>
        // Global variables
        let userRole = 'guest';
        let isFirebaseReady = false;
        let charts = {};
        
        // Local data storage (fallback when Firebase is not ready)
        let localData = {
            teams: [
                { id: 'team1', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á', color: '#ef4444', unityScore: 1020, sportsScore: 0, totalScore: 1020, gold: 0, silver: 0, bronze: 0 },
                { id: 'team2', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', color: '#3b82f6', unityScore: 975, sportsScore: 0, totalScore: 975, gold: 0, silver: 0, bronze: 0 },
                { id: 'team3', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', color: '#f59e0b', unityScore: 1030, sportsScore: 0, totalScore: 1030, gold: 0, silver: 0, bronze: 0 },
                { id: 'team4', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', color: '#22c55e', unityScore: 985, sportsScore: 0, totalScore: 985, gold: 0, silver: 0, bronze: 0 }
            ],
            unityHistory: [
                { id: 'unity1', date: '15 ‡∏°.‡∏Ñ. 2025', teamId: 'team2', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', score: -25, type: 'deduct', notes: '‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô‡∏™‡∏ô‡∏≤‡∏°' },
                { id: 'unity2', date: '15 ‡∏°.‡∏Ñ. 2025', teamId: 'team1', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á', score: 20, type: 'add', notes: '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏î‡∏µ' },
                { id: 'unity3', date: '14 ‡∏°.‡∏Ñ. 2025', teamId: 'team4', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', score: -15, type: 'deduct', notes: '‡∏°‡∏≤‡∏™‡∏≤‡∏¢' },
                { id: 'unity4', date: '14 ‡∏°.‡∏Ñ. 2025', teamId: 'team3', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', score: 30, type: 'add', notes: '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°' }
            ]
        };

        // Firebase initialization function (called when Firebase is ready)
        window.initializeFirebaseData = async function() {
            if (!window.db || !window.firestore) {
                console.log('Firebase not ready yet');
                return;
            }

            try {
                isFirebaseReady = true;
                updateFirebaseStatus(true);
                
                // Initialize collections with default data if they don't exist
                await initializeCollections();
                
                // Set up real-time listeners
                setupRealtimeListeners();
                
                console.log('Firebase initialized successfully');
                
                // Load data after Firebase is ready
                loadTeamsData();
                loadUnityData();
                updateDashboard();
                updateExportSummary();
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateFirebaseStatus(false);
                isFirebaseReady = false;
                
                // Load local data as fallback
                loadTeamsData();
                loadUnityData();
                updateDashboard();
                updateExportSummary();
            }
        };

        // Update Firebase status indicator
        function updateFirebaseStatus(connected) {
            const statusEl = document.getElementById('firebaseStatus');
            if (connected) {
                statusEl.className = 'firebase-status firebase-connected';
                statusEl.innerHTML = '<i class="fas fa-circle mr-1"></i>Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                statusEl.className = 'firebase-status firebase-disconnected';
                statusEl.innerHTML = '<i class="fas fa-circle mr-1"></i>Firebase ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            }
        }

        // Initialize Firebase collections with default data
        async function initializeCollections() {
            const { collection, getDocs, setDoc, doc } = window.firestore;
            
            try {
                // Check if collections exist, if not create them with default data
                const collections = ['teams', 'unityHistory'];
                
                for (const collectionName of collections) {
                    const snapshot = await getDocs(collection(window.db, collectionName));
                    
                    if (snapshot.empty) {
                        console.log(`Initializing ${collectionName} collection`);
                        const data = localData[collectionName];
                        
                        for (const item of data) {
                            await setDoc(doc(window.db, collectionName, item.id), item);
                        }
                    }
                }
            } catch (error) {
                console.error('Error initializing collections:', error);
            }
        }

        // Set up real-time listeners for all collections
        function setupRealtimeListeners() {
            const { collection, onSnapshot } = window.firestore;

            // Listen to teams changes
            onSnapshot(collection(window.db, 'teams'), (snapshot) => {
                localData.teams = [];
                snapshot.forEach((doc) => {
                    localData.teams.push({ id: doc.id, ...doc.data() });
                });
                loadTeamsData();
                updateDashboard();
                updateCharts();
                updateExportSummary();
            });

            // Listen to unity history changes
            onSnapshot(collection(window.db, 'unityHistory'), (snapshot) => {
                localData.unityHistory = [];
                snapshot.forEach((doc) => {
                    localData.unityHistory.push({ id: doc.id, ...doc.data() });
                });
                loadUnityData();
                updateExportSummary();
            });
        }

        // Firebase CRUD operations with better error handling
        async function saveToFirebase(collectionName, data, docId = null) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, saving locally only');
                throw new Error('Firebase not connected');
            }

            if (!window.db || !window.firestore) {
                console.log('Firebase objects not available');
                throw new Error('Firebase not initialized');
            }

            try {
                const { collection, addDoc, setDoc, doc } = window.firestore;
                
                console.log(`Saving to Firebase collection: ${collectionName}`, { docId, dataKeys: Object.keys(data) });
                
                if (docId) {
                    await setDoc(doc(window.db, collectionName, docId), data);
                    console.log(`Successfully saved document ${docId} to ${collectionName}`);
                } else {
                    const docRef = await addDoc(collection(window.db, collectionName), data);
                    console.log(`Successfully added document ${docRef.id} to ${collectionName}`);
                    return docRef.id;
                }
            } catch (error) {
                console.error(`Error saving to Firebase ${collectionName}:`, error);
                throw new Error(`Firebase save failed: ${error.message}`);
            }
        }

        async function updateFirebaseDoc(collectionName, docId, data) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, updating locally only');
                return;
            }

            try {
                const { updateDoc, doc } = window.firestore;
                await updateDoc(doc(window.db, collectionName, docId), data);
            } catch (error) {
                console.error('Error updating Firebase document:', error);
                throw error;
            }
        }

        async function deleteFromFirebase(collectionName, docId) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, deleting locally only');
                return;
            }

            try {
                const { deleteDoc, doc } = window.firestore;
                await deleteDoc(doc(window.db, collectionName, docId));
            } catch (error) {
                console.error('Error deleting from Firebase:', error);
                throw error;
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check credentials
            if (username === 'TUPPSC' && password === 'JetniphatInwza007naja') {
                userRole = 'admin';
                loginUser('Admin (TUPPSC)', '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
            } else {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    confirmButtonColor: '#3b82f6'
                });
            }
        });

        // Guest login functionality
        function guestLogin() {
            userRole = 'guest';
            loginUser('‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°', '‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß');
        }

        // Common login function
        function loginUser(displayName, roleText) {
            // Show loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            setTimeout(() => {
                // Hide login modal and show main app
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update current user display
                document.getElementById('currentUser').textContent = displayName;
                
                // Set user permissions
                setUserPermissions();
                
                // Initialize charts after login
                initCharts();
                
                // Load dynamic data
                loadTeamsData();
                loadUnityData();
                updateDashboard();
                updateExportSummary();
                
                Swal.fire({
                    icon: 'success',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${roleText}`,
                    timer: 800,
                    showConfirmButton: false
                });
            }, 200);
        }

        // Set user permissions based on role
        function setUserPermissions() {
            const adminElements = document.querySelectorAll('.admin-only');
            const guestElements = document.querySelectorAll('.guest-only');
            
            if (userRole === 'admin') {
                // Show admin elements
                adminElements.forEach(el => {
                    el.style.display = '';
                });
                // Hide guest-only elements
                guestElements.forEach(el => {
                    el.style.display = 'none';
                });
            } else {
                // Hide admin elements
                adminElements.forEach(el => {
                    el.style.display = 'none';
                });
                // Show guest-only elements
                guestElements.forEach(el => {
                    el.style.display = '';
                });
            }
        }

        // Logout functionality
        function logout() {
            Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Reset user role
                    userRole = 'guest';
                    
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('loginModal').classList.remove('hidden');
                    
                    // Reset login form
                    document.getElementById('loginForm').reset();
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            });
        }

        // Initialize charts
        function initCharts() {
            const teams = [...localData.teams].sort((a, b) => b.unityScore - a.unityScore);
            
            // Unity Chart
            const unityCtx = document.getElementById('unityChart').getContext('2d');
            if (charts.unityChart) {
                charts.unityChart.destroy();
            }
            charts.unityChart = new Chart(unityCtx, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ',
                        data: teams.map(team => team.unityScore),
                        backgroundColor: teams.map(team => team.color + '80'),
                        borderColor: teams.map(team => team.color),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: 900,
                            max: 1100,
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
            
            // Update unity ranking
            updateUnityRanking();
        }

        // Update charts with new data
        function updateCharts() {
            if (Object.keys(charts).length > 0) {
                initCharts();
            }
        }

        // Update dashboard statistics
        function updateDashboard() {
            const teams = localData.teams;
            const totalTeams = teams.length;
            const avgScore = teams.reduce((sum, team) => sum + team.unityScore, 0) / totalTeams;
            const maxScore = Math.max(...teams.map(team => team.unityScore));
            const totalRecords = localData.unityHistory.length;

            document.getElementById('totalTeams').textContent = totalTeams;
            document.getElementById('avgScore').textContent = avgScore.toFixed(1);
            document.getElementById('maxScore').textContent = maxScore;
            document.getElementById('totalRecords').textContent = totalRecords;
        }

        // Update unity ranking
        function updateUnityRanking() {
            const teams = [...localData.teams].sort((a, b) => b.unityScore - a.unityScore);
            const rankingDiv = document.getElementById('unityRanking');
            
            rankingDiv.innerHTML = '';
            
            teams.forEach((team, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = 'flex items-center justify-between p-3 bg-white/10 rounded-lg';
                
                let medal = '';
                if (index === 0) medal = 'ü•á';
                else if (index === 1) medal = 'ü•à';
                else if (index === 2) medal = 'ü•â';
                else medal = `#${index + 1}`;
                
                rankItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">${medal}</span>
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-2" style="background-color: ${team.color}"></div>
                            <span class="text-white font-medium">${team.name}</span>
                        </div>
                    </div>
                    <span class="text-white text-xl font-bold">${team.unityScore}</span>
                `;
                
                rankingDiv.appendChild(rankItem);
            });
        }

        // Update export summary
        function updateExportSummary() {
            const summaryDiv = document.getElementById('exportSummary');
            if (!summaryDiv) return;
            
            const teams = [...localData.teams].sort((a, b) => b.unityScore - a.unityScore);
            
            summaryDiv.innerHTML = '';
            
            teams.forEach(team => {
                const summaryItem = document.createElement('div');
                summaryItem.className = 'flex items-center justify-between text-white/80 text-sm';
                summaryItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${team.color}"></div>
                        ${team.name}
                    </div>
                    <span class="font-bold">${team.unityScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                `;
                summaryDiv.appendChild(summaryItem);
            });

            // Update statistics
            const addRecords = localData.unityHistory.filter(r => r.type === 'add');
            const deductRecords = localData.unityHistory.filter(r => r.type === 'deduct');
            
            const addCountEl = document.getElementById('addCount');
            const deductCountEl = document.getElementById('deductCount');
            const totalCountEl = document.getElementById('totalCount');
            
            if (addCountEl) addCountEl.textContent = addRecords.length;
            if (deductCountEl) deductCountEl.textContent = deductRecords.length;
            if (totalCountEl) totalCountEl.textContent = localData.unityHistory.length;
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active-nav');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Add active class to clicked nav item
            event.target.classList.add('active-nav');
        }

        // Add Score Form submission
        document.getElementById('addScoreForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const teamId = document.getElementById('addTeamSelect').value;
            const score = parseInt(document.getElementById('addScore').value);
            const notes = document.getElementById('addNotes').value;
            
            if (!teamId || !score || !notes) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            await processScoreChange(teamId, score, 'add', notes);
        });

        // Deduct Score Form submission
        document.getElementById('deductScoreForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const teamId = document.getElementById('deductTeamSelect').value;
            const score = parseInt(document.getElementById('deductScore').value);
            const notes = document.getElementById('deductNotes').value;
            
            if (!teamId || !score || !notes) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            await processScoreChange(teamId, -score, 'deduct', notes);
        });

        // Process score change
        async function processScoreChange(teamId, scoreChange, type, notes) {
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const actionText = type === 'add' ? '‡πÄ‡∏û‡∏¥‡πà‡∏°' : '‡∏´‡∏±‡∏Å';
            const scoreText = Math.abs(scoreChange);
            
            try {
                // Show loading with timeout warning
                let loadingTimer;
                Swal.fire({
                    title: `‡∏Å‡∏≥‡∏•‡∏±‡∏á${actionText}‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...`,
                    html: `<div class="text-center">
                        <div class="mb-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Firebase</div>
                        <div class="text-sm text-gray-600">‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                    </div>`,
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                        
                        // Set timeout warning
                        loadingTimer = setTimeout(() => {
                            Swal.update({
                                html: `<div class="text-center">
                                    <div class="mb-3 text-orange-600">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</div>
                                    <div class="text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                                    <div class="text-xs mt-2">Firebase Status: ${isFirebaseReady ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß' : '‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'}</div>
                                </div>`
                            });
                        }, 5000);
                    }
                });

                // Create unity record with unique ID
                const recordId = 'unity_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const unityRecord = {
                    id: recordId,
                    date: new Date().toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' }),
                    teamId: teamId,
                    teamName: team.name,
                    score: scoreChange,
                    type: type,
                    notes: notes,
                    timestamp: new Date().toISOString()
                };
                
                // Update local data first (for immediate UI update)
                localData.unityHistory.unshift(unityRecord);
                
                // Update team score locally
                const teamIndex = localData.teams.findIndex(t => t.id === teamId);
                if (teamIndex !== -1) {
                    localData.teams[teamIndex] = {
                        ...team,
                        unityScore: team.unityScore + scoreChange,
                        totalScore: (team.sportsScore || 0) + team.unityScore + scoreChange
                    };
                }
                
                // Save to Firebase (with timeout)
                const savePromise = Promise.all([
                    saveToFirebase('unityHistory', unityRecord, recordId),
                    updateFirebaseDoc('teams', teamId, localData.teams[teamIndex])
                ]);
                
                // Add timeout to Firebase operations
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Timeout')), 15000);
                });
                
                try {
                    await Promise.race([savePromise, timeoutPromise]);
                    clearTimeout(loadingTimer);
                    
                    // Clear forms
                    clearScoreForms();
                    
                    // Update UI immediately
                    loadTeamsData();
                    loadUnityData();
                    updateDashboard();
                    updateCharts();
                    updateExportSummary();
                    
                    Swal.fire({
                        icon: 'success',
                        title: `${actionText}‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ`,
                        html: `<div class="text-center">
                            <div class="text-lg mb-2">${actionText}‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <strong>${scoreText}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div class="text-md">‡πÉ‡∏´‡πâ <strong>${team.name}</strong></div>
                            <div class="text-sm text-gray-600 mt-2">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
                        </div>`,
                        timer: 3000,
                        showConfirmButton: false
                    });
                    
                } catch (firebaseError) {
                    clearTimeout(loadingTimer);
                    
                    if (firebaseError.message === 'Timeout') {
                        Swal.fire({
                            icon: 'warning',
                            title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πâ‡∏≤ ‚è∞',
                            html: `<div class="text-center">
                                <div class="mb-3">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</div>
                                <div class="text-sm text-green-600">‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                                <div class="text-xs mt-2">Firebase ‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô</div>
                            </div>`,
                            confirmButtonColor: '#3b82f6'
                        });
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚ö†Ô∏è',
                            html: `<div class="text-center">
                                <div class="mb-3">‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                                <div class="text-sm text-orange-600">‚ö†Ô∏è Firebase ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                                <div class="text-xs mt-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</div>
                            </div>`,
                            confirmButtonColor: '#3b82f6'
                        });
                    }
                    
                    // Clear forms and update UI anyway
                    clearScoreForms();
                    loadTeamsData();
                    loadUnityData();
                    updateDashboard();
                    updateCharts();
                    updateExportSummary();
                }
                
            } catch (error) {
                console.error('Score change error:', error);
                
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå',
                    html: `<div class="text-center">
                        <div class="mb-3">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ${actionText}‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ</div>
                        <div class="text-sm text-red-600">Error: ${error.message}</div>
                        <div class="text-xs mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    </div>`,
                    confirmButtonColor: '#3b82f6'
                });
            }
        }

        // Clear score forms
        function clearScoreForms() {
            document.getElementById('addScoreForm').reset();
            document.getElementById('deductScoreForm').reset();
        }

        // Load teams data
        function loadTeamsData() {
            const teamsGrid = document.getElementById('teamsGrid');
            if (teamsGrid) {
                teamsGrid.innerHTML = '';
                
                localData.teams.forEach(team => {
                    const teamCard = document.createElement('div');
                    teamCard.className = 'bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover';
                    teamCard.innerHTML = `
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-6 h-6 rounded-full mr-3" style="background-color: ${team.color}"></div>
                                <h3 class="text-xl font-bold text-white">${team.name}</h3>
                            </div>
                            <div class="flex space-x-2 admin-only">
                                <button class="text-white/80 hover:text-white" onclick="editTeam('${team.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-white/80 hover:text-white" onclick="deleteTeam('${team.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-white/80 text-sm">
                            <div>
                                <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤: <span class="font-bold text-white">${team.sportsScore || 0}</span></p>
                                <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ: <span class="font-bold text-white">${team.unityScore}</span></p>
                            </div>
                            <div>
                                <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span class="font-bold text-white text-lg">${(team.sportsScore || 0) + team.unityScore}</span></p>
                                <p>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: <span class="font-bold text-white">${(team.gold || 0) + (team.silver || 0) + (team.bronze || 0)}</span></p>
                            </div>
                        </div>
                    `;
                    teamsGrid.appendChild(teamCard);
                });
            }
            
            // Update team select options
            updateTeamSelects();
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Load unity data
        function loadUnityData() {
            const unityHistoryTable = document.getElementById('unityHistoryTable');
            if (!unityHistoryTable) return;
            
            unityHistoryTable.innerHTML = '';
            
            localData.unityHistory.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'border-b border-white/10';
                
                const typeText = record.type === 'add' ? '‡πÄ‡∏û‡∏¥‡πà‡∏°' : '‡∏´‡∏±‡∏Å';
                const typeClass = record.type === 'add' ? 'text-green-400' : 'text-red-400';
                
                row.innerHTML = `
                    <td class="py-3 px-4">${record.date}</td>
                    <td class="py-3 px-4">${record.teamName}</td>
                    <td class="py-3 px-4 text-center">
                        <span class="${typeClass} font-bold">${typeText}</span>
                    </td>
                    <td class="py-3 px-4 text-center font-bold">${Math.abs(record.score)}</td>
                    <td class="py-3 px-4">${record.notes}</td>
                    <td class="py-3 px-4 text-center">
                        <div class="admin-only">
                            <button class="text-red-400 hover:text-red-300" onclick="deleteUnityRecord('${record.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="guest-only">
                            <span class="text-white/50 text-sm">-</span>
                        </div>
                    </td>
                `;
                unityHistoryTable.appendChild(row);
            });
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Update team select options
        function updateTeamSelects() {
            const selects = ['addTeamSelect', 'deductTeamSelect'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Keep the first option
                    const firstOption = select.querySelector('option');
                    select.innerHTML = '';
                    if (firstOption) {
                        select.appendChild(firstOption);
                    } else {
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ';
                        select.appendChild(defaultOption);
                    }
                    
                    // Add team options
                    localData.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = team.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Delete unity record
        async function deleteUnityRecord(recordId) {
            if (userRole !== 'admin') return;
            
            const record = localData.unityHistory.find(r => r.id === recordId);
            if (!record) return;
            
            const result = await Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?',
                text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ${Math.abs(record.score)} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á ${record.teamName} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Find team and subtract score
                    const team = localData.teams.find(t => t.id === record.teamId);
                    if (team) {
                        const updatedTeam = {
                            ...team,
                            unityScore: team.unityScore - record.score,
                            totalScore: (team.sportsScore || 0) + team.unityScore - record.score
                        };
                        
                        await updateFirebaseDoc('teams', record.teamId, updatedTeam);
                    }
                    
                    // Delete unity record
                    await deleteFromFirebase('unityHistory', recordId);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Team management functions
        async function showAddTeamModal() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const { value: formValues } = await Swal.fire({
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà',
                html: `
                    <div class="grid grid-cols-1 gap-4 text-left">
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                            <input type="text" id="modalTeamName" class="w-full px-3 py-2 border rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏ì‡∏∞</label>
                            <input type="color" id="modalTeamColor" class="w-full px-3 py-2 border rounded-lg" value="#8b5cf6">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡πÄ‡∏û‡∏¥‡πà‡∏°',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                preConfirm: () => {
                    const name = document.getElementById('modalTeamName').value;
                    const color = document.getElementById('modalTeamColor').value;
                    
                    if (!name || !color) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, color };
                }
            });

            if (formValues) {
                try {
                    const newTeam = {
                        name: formValues.name,
                        color: formValues.color,
                        sportsScore: 0,
                        unityScore: 1000,
                        totalScore: 1000,
                        gold: 0,
                        silver: 0,
                        bronze: 0,
                        timestamp: new Date().toISOString()
                    };
                    
                    await saveToFirebase('teams', newTeam);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        async function editTeam(teamId) {
            if (userRole !== 'admin') return;
            
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const { value: formValues } = await Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ',
                html: `
                    <div class="grid grid-cols-1 gap-4 text-left">
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                            <input type="text" id="editTeamName" class="w-full px-3 py-2 border rounded-lg" value="${team.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏ì‡∏∞</label>
                            <input type="color" id="editTeamColor" class="w-full px-3 py-2 border rounded-lg" value="${team.color}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤</label>
                            <input type="number" id="editSportsScore" class="w-full px-3 py-2 border rounded-lg" value="${team.sportsScore || 0}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏≠‡∏á</label>
                            <input type="number" id="editGold" class="w-full px-3 py-2 border rounded-lg" value="${team.gold || 0}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <input type="number" id="editSilver" class="w-full px-3 py-2 border rounded-lg" value="${team.silver || 0}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á</label>
                            <input type="number" id="editBronze" class="w-full px-3 py-2 border rounded-lg" value="${team.bronze || 0}">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                preConfirm: () => {
                    const name = document.getElementById('editTeamName').value;
                    const color = document.getElementById('editTeamColor').value;
                    const sportsScore = parseInt(document.getElementById('editSportsScore').value) || 0;
                    const gold = parseInt(document.getElementById('editGold').value) || 0;
                    const silver = parseInt(document.getElementById('editSilver').value) || 0;
                    const bronze = parseInt(document.getElementById('editBronze').value) || 0;
                    
                    if (!name || !color) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, color, sportsScore, gold, silver, bronze };
                }
            });

            if (formValues) {
                try {
                    const updatedTeam = {
                        ...team,
                        ...formValues,
                        totalScore: formValues.sportsScore + team.unityScore
                    };
                    
                    await updateFirebaseDoc('teams', teamId, updatedTeam);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        async function deleteTeam(teamId) {
            if (userRole !== 'admin') return;
            
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const result = await Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ?',
                text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${team.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Delete team
                    await deleteFromFirebase('teams', teamId);
                    
                    // Delete related unity history
                    const relatedRecords = localData.unityHistory.filter(r => r.teamId === teamId);
                    for (const record of relatedRecords) {
                        await deleteFromFirebase('unityHistory', record.id);
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Export functions (placeholder)
        function exportPDF() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#3b82f6'
                });
            }, 2000);
        }

        function exportExcel() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#3b82f6'
                });
            }, 2000);
        }

        // System status check function
        async function checkSystemStatus() {
            if (userRole !== 'admin') return;
            
            Swal.fire({
                title: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö üîç',
                html: `<div class="text-left space-y-3">
                    <div id="statusCheck" class="text-sm">
                        <div class="mb-2">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                    </div>
                </div>`,
                showConfirmButton: false,
                allowOutsideClick: false,
                didOpen: async () => {
                    const statusDiv = document.getElementById('statusCheck');
                    let statusHTML = '';
                    
                    // Check Firebase connection
                    statusHTML += `<div class="flex justify-between py-1">
                        <span>Firebase Connection:</span>
                        <span class="${isFirebaseReady ? 'text-green-600' : 'text-red-600'}">${isFirebaseReady ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠' : '‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'}</span>
                    </div>`;
                    
                    // Check Firebase objects
                    const hasDB = !!window.db;
                    const hasFirestore = !!window.firestore;
                    statusHTML += `<div class="flex justify-between py-1">
                        <span>Firebase Database:</span>
                        <span class="${hasDB ? 'text-green-600' : 'text-red-600'}">${hasDB ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°' : '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'}</span>
                    </div>`;
                    
                    statusHTML += `<div class="flex justify-between py-1">
                        <span>Firestore Functions:</span>
                        <span class="${hasFirestore ? 'text-green-600' : 'text-red-600'}">${hasFirestore ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°' : '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'}</span>
                    </div>`;
                    
                    // Check data
                    statusHTML += `<div class="flex justify-between py-1">
                        <span>Teams Data:</span>
                        <span class="text-blue-600">üìä ${localData.teams.length} ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</span>
                    </div>`;
                    
                    statusHTML += `<div class="flex justify-between py-1">
                        <span>Unity Records:</span>
                        <span class="text-blue-600">üìù ${localData.unityHistory.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>`;
                    
                    // Test Firebase write
                    if (isFirebaseReady && hasDB && hasFirestore) {
                        statusHTML += `<div class="flex justify-between py-1">
                            <span>Firebase Write Test:</span>
                            <span class="text-yellow-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</span>
                        </div>`;
                        
                        statusDiv.innerHTML = statusHTML;
                        
                        try {
                            const testData = {
                                test: true,
                                timestamp: new Date().toISOString()
                            };
                            
                            await saveToFirebase('systemTest', testData, 'test_' + Date.now());
                            
                            statusHTML = statusHTML.replace(
                                '<span class="text-yellow-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</span>',
                                '<span class="text-green-600">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>'
                            );
                            
                            // Clean up test document
                            try {
                                await deleteFromFirebase('systemTest', 'test_' + Date.now());
                            } catch (e) {
                                console.log('Test cleanup failed (normal)');
                            }
                            
                        } catch (error) {
                            statusHTML = statusHTML.replace(
                                '<span class="text-yellow-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</span>',
                                `<span class="text-red-600">‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</span>`
                            );
                            
                            statusHTML += `<div class="mt-3 p-2 bg-red-100 rounded text-red-800 text-xs">
                                <strong>Error:</strong> ${error.message}
                            </div>`;
                        }
                    }
                    
                    // Performance info
                    statusHTML += `<div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="text-xs text-gray-600">
                            <div>User Agent: ${navigator.userAgent.split(' ').slice(-2).join(' ')}</div>
                            <div>Connection: ${navigator.onLine ? 'Online' : 'Offline'}</div>
                            <div>Last Update: ${new Date().toLocaleTimeString('th-TH')}</div>
                        </div>
                    </div>`;
                    
                    statusDiv.innerHTML = statusHTML;
                    
                    // Add close button after 2 seconds
                    setTimeout(() => {
                        Swal.update({
                            showConfirmButton: true,
                            confirmButtonText: '‡∏õ‡∏¥‡∏î',
                            confirmButtonColor: '#3b82f6'
                        });
                    }, 2000);
                }
            });
        }

        // Initialize on page load
        $(document).ready(function() {
            // Set current time
            const now = new Date();
            document.getElementById('loginTime').textContent = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            }) + ' ‡∏ô.';
            
            // Initialize Firebase status as disconnected
            updateFirebaseStatus(false);
            
            // Load initial data
            loadTeamsData();
            loadUnityData();
            updateDashboard();
            updateExportSummary();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9865b4e594717b42',t:'MTc1OTA4ODM2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
