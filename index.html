<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, getDocs, query, orderBy, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCx30_dsjjFJW8FgXyVBI5VkTE5k6Dc8qQ",
            authDomain: "sports-management-system-1ce0e.firebaseapp.com",
            databaseURL: "https://sports-management-system-1ce0e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sports-management-system-1ce0e",
            storageBucket: "sports-management-system-1ce0e.firebasestorage.app",
            messagingSenderId: "110723728337",
            appId: "1:110723728337:web:1c200d0992cb84df3f16f0",
            measurementId: "G-Q79K6G29FN"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.firestore = { collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, getDocs, query, orderBy, setDoc };
        window.isFirebaseReady = true;
        
        // Initialize data when Firebase is ready
        window.initializeFirebaseData();
    </script>
    
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Anuphan', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 25%, #0ea5e9 50%, #38bdf8 75%, #7dd3fc 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        .active-nav {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
        }
        .sport-card {
            background: linear-gradient(45deg, #3b82f6, #1e40af);
        }
        .team-card {
            background: linear-gradient(45deg, #0ea5e9, #0284c7);
        }
        .firebase-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .firebase-connected {
            background: #10b981;
            color: white;
        }
        .firebase-disconnected {
            background: #ef4444;
            color: white;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Firebase Status Indicator -->
    <div id="firebaseStatus" class="firebase-status firebase-disconnected">
        <i class="fas fa-circle mr-1"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="bg-white/20 backdrop-blur-md rounded-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trophy text-4xl text-blue-600"></i>
                </div>
                <h2 class="text-white text-2xl font-bold mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <p class="text-white/80">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</p>
                <p class="text-white/60 text-sm mt-2">üî• ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-white text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                </div>
                
                <div>
                    <label class="block text-white text-sm font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-sign-in-alt mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
                
                <button type="button" onclick="guestLogin()" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-eye mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-white/60 text-sm">Admin: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ | ‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="bg-white/10 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center">
                        <i class="fas fa-trophy text-2xl text-purple-600"></i>
                    </div>
                    <div>
                        <h1 class="text-white text-xl md:text-2xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</h1>
                        <p class="text-white/80 text-sm">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-white text-right">
                        <p class="text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span id="currentUser">Admin</span></p>
                        <p class="text-xs text-white/70">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: <span id="loginTime">10:30 ‡∏ô.</span></p>
                    </div>
                    <button class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all" onclick="logout()">
                        <i class="fas fa-sign-out-alt mr-2"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-md border-b border-white/20">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center md:justify-start space-x-2 md:space-x-6 py-3">
                <button class="nav-item active-nav text-white px-4 py-2 text-sm md:text-base" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line mr-2"></i>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <button id="recordNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('record')">
                    <i class="fas fa-plus-circle mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
                </button>
                <button class="nav-item text-white px-4 py-2 text-sm md:text-base" onclick="showSection('scoreboard')">
                    <i class="fas fa-medal mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                </button>
                <button class="nav-item text-white px-4 py-2 text-sm md:text-base" onclick="showSection('schedule')">
                    <i class="fas fa-calendar mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                </button>
                <button id="sportsNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('sports')">
                    <i class="fas fa-cog mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏µ‡∏¨‡∏≤
                </button>
                <button id="teamsNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('teams')">
                    <i class="fas fa-users mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                </button>
                <button id="unityNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('unity')">
                    <i class="fas fa-heart mr-2"></i>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
                </button>
                <button id="exportNav" class="nav-item text-white px-4 py-2 text-sm md:text-base admin-only" onclick="showSection('export')">
                    <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Stats Cards -->
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-white text-3xl font-bold" id="totalMatches">24</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-gamepad text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-white text-3xl font-bold" id="completedMatches">18</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-check-circle text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</p>
                            <p class="text-white text-3xl font-bold" id="totalSports">8</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-running text-white text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</p>
                            <p class="text-white text-3xl font-bold" id="totalTeams">4</p>
                        </div>
                        <div class="w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6">
                    <h3 class="text-white text-xl font-bold mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</h3>
                    <canvas id="scoreChart" width="400" height="300"></canvas>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6">
                    <h3 class="text-white text-xl font-bold mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</h3>
                    <canvas id="unityChart" width="400" height="300"></canvas>
                </div>

                <div class="bg-white/20 backdrop-blur-md rounded-xl p-6">
                    <h3 class="text-white text-xl font-bold mb-4">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</h3>
                    <canvas id="medalChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Record Results Section -->
        <div id="record" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-plus-circle mr-3"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                </h2>
                
                <form id="recordForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</label>
                        <select id="sportSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</option>
                            <option value="football">‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</option>
                            <option value="basketball">‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•</option>
                            <option value="volleyball">‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•</option>
                            <option value="badminton">‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô</option>
                            <option value="tabletennis">‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á</option>
                            <option value="athletics">‡∏Å‡∏£‡∏µ‡∏ë‡∏≤</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <select id="roundSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</option>
                            <option value="preliminary">‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å</option>
                            <option value="semifinal">‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á</option>
                            <option value="final">‡∏£‡∏≠‡∏ö‡∏ä‡∏¥‡∏á</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà 1</label>
                        <select id="team1Select" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà 1</label>
                        <input type="number" id="score1" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="0">
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà 2</label>
                        <select id="team2Select" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà 2</label>
                        <input type="number" id="score2" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="0">
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-white text-sm font-medium mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="notes" rows="3" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>

                    <div class="md:col-span-2 flex justify-end space-x-4">
                        <button type="button" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-all">
                            <i class="fas fa-times mr-2"></i>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg transition-all">
                            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Scoreboard Section -->
        <div id="scoreboard" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-medal mr-3"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°
                </h2>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-white">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-4 px-4">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="text-left py-4 px-4">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</th>
                                <th class="text-center py-4 px-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤</th>
                                <th class="text-center py-4 px-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</th>
                                <th class="text-center py-4 px-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</th>
                                <th class="text-center py-4 px-4">ü•á</th>
                                <th class="text-center py-4 px-4">ü•à</th>
                                <th class="text-center py-4 px-4">ü•â</th>
                            </tr>
                        </thead>
                        <tbody id="scoreboardTable">
                            <!-- Dynamic content will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Schedule Section -->
        <div id="schedule" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-white text-2xl font-bold mb-4 md:mb-0">
                        <i class="fas fa-calendar mr-3"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                    </h2>
                    <button class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-3 rounded-lg transition-all admin-only" onclick="showAddScheduleModal()">
                        <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                    </button>
                </div>

                <!-- Filter -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <input type="date" id="dateFilter" class="px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <select id="sportFilter" class="px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</option>
                        <option value="football">‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</option>
                        <option value="basketball">‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•</option>
                        <option value="volleyball">‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•</option>
                    </select>
                    <input type="text" id="searchSchedule" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." class="px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Schedule Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-white">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-4 px-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="text-left py-4 px-4">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="text-left py-4 px-4">‡∏Å‡∏µ‡∏¨‡∏≤</th>
                                <th class="text-left py-4 px-4">‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</th>
                                <th class="text-left py-4 px-4">‡∏™‡∏ô‡∏≤‡∏°</th>
                                <th class="text-center py-4 px-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="text-center py-4 px-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTable">
                            <!-- Schedule will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sports Management Section -->
        <div id="sports" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-white text-2xl font-bold mb-4 md:mb-0">
                        <i class="fas fa-cog mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤
                    </h2>
                    <button class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-3 rounded-lg transition-all admin-only" onclick="showAddSportModal()">
                        <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤
                    </button>
                </div>

                <div id="sportsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Sports will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Teams Management Section -->
        <div id="teams" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-white text-2xl font-bold mb-4 md:mb-0">
                        <i class="fas fa-users mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                    </h2>
                    <button class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-3 rounded-lg transition-all admin-only" onclick="showAddTeamModal()">
                        <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ
                    </button>
                </div>

                <div id="teamsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Teams will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Unity Score Section -->
        <div id="unity" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-heart mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
                </h2>
                
                <form id="unityForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                        <select id="unityTeamSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</label>
                        <input type="number" id="unityScore" min="0" max="100" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="0-100">
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-white text-sm font-medium mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="unityNotes" rows="3" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>

                    <div class="md:col-span-2 flex justify-end space-x-4">
                        <button type="button" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-all" onclick="clearUnityForm()">
                            <i class="fas fa-times mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button type="submit" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg transition-all">
                            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                        </button>
                    </div>
                </form>

                <!-- Unity Score History -->
                <div class="bg-white/10 rounded-xl p-6">
                    <h3 class="text-white text-lg font-bold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left py-3 px-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="text-left py-3 px-4">‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</th>
                                    <th class="text-center py-3 px-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                    <th class="text-left py-3 px-4">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    <th class="text-center py-3 px-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="unityHistoryTable">
                                <!-- Unity history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div id="export" class="section hidden">
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-8">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-download mr-3"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="team-card rounded-xl p-6 text-white card-hover">
                        <div class="text-center">
                            <i class="fas fa-file-pdf text-6xl mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</h3>
                            <p class="text-white/80 mb-4">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö PDF</p>
                            <button class="bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-lg transition-all w-full" onclick="exportPDF()">
                                <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF
                            </button>
                        </div>
                    </div>

                    <div class="team-card rounded-xl p-6 text-white card-hover">
                        <div class="text-center">
                            <i class="fas fa-file-excel text-6xl mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel</h3>
                            <p class="text-white/80 mb-4">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Excel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
                            <button class="bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-lg transition-all w-full" onclick="exportExcel()">
                                <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-8 bg-white/10 rounded-xl p-6">
                    <h3 class="text-white text-lg font-bold mb-4">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <div class="flex space-x-2">
                                <input type="date" class="flex-1 px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <span class="text-white self-center">‡∏ñ‡∏∂‡∏á</span>
                                <input type="date" class="flex-1 px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</label>
                            <select class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤</option>
                                <option value="football">‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</option>
                                <option value="basketball">‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•</option>
                                <option value="volleyball">‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/10 backdrop-blur-md border-t border-white/20 mt-16">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-white">
                <p>&copy; 2025 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥</p>
                <p class="text-white/70 text-sm mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase</p>
            </div>
        </div>
    </footer>
    </div> <!-- End Main App -->

    <script>
        // Global variables
        let userRole = 'guest';
        let isFirebaseReady = false;
        let charts = {};
        
        // Local data storage (fallback when Firebase is not ready)
        let localData = {
            sports: [
                { id: 'sport1', name: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•', teams: 4, matches: 6 },
                { id: 'sport2', name: '‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•', teams: 4, matches: 6 },
                { id: 'sport3', name: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•', teams: 4, matches: 6 },
                { id: 'sport4', name: '‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô', teams: 4, matches: 6 },
                { id: 'sport5', name: '‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á', teams: 4, matches: 6 },
                { id: 'sport6', name: '‡∏Å‡∏£‡∏µ‡∏ë‡∏≤', teams: 4, matches: 8 }
            ],
            teams: [
                { id: 'team1', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á', color: '#ef4444', sportsScore: 270, unityScore: 85, totalScore: 355, gold: 6, silver: 7, bronze: 4 },
                { id: 'team2', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', color: '#3b82f6', sportsScore: 285, unityScore: 92, totalScore: 377, gold: 8, silver: 5, bronze: 3 },
                { id: 'team3', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', color: '#f59e0b', sportsScore: 230, unityScore: 78, totalScore: 308, gold: 3, silver: 4, bronze: 7 },
                { id: 'team4', name: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', color: '#22c55e', sportsScore: 245, unityScore: 88, totalScore: 333, gold: 4, silver: 6, bronze: 8 }
            ],
            schedule: [
                { id: 'schedule1', date: '15 ‡∏°.‡∏Ñ. 2025', time: '09:00', sport: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•', match: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á vs ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', venue: '‡∏™‡∏ô‡∏≤‡∏°‡∏´‡∏ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°', status: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' },
                { id: 'schedule2', date: '15 ‡∏°.‡∏Ñ. 2025', time: '10:30', sport: '‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•', match: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á vs ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', venue: '‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏≤‡∏™ A', status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Ç‡πà‡∏á' },
                { id: 'schedule3', date: '15 ‡∏°.‡∏Ñ. 2025', time: '14:00', sport: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•', match: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á vs ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', venue: '‡πÇ‡∏£‡∏á‡∏¢‡∏¥‡∏°', status: '‡∏£‡∏≠‡πÅ‡∏Ç‡πà‡∏á' },
                { id: 'schedule4', date: '16 ‡∏°.‡∏Ñ. 2025', time: '09:00', sport: '‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô', match: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô vs ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', venue: '‡πÇ‡∏£‡∏á‡∏¢‡∏¥‡∏° B', status: '‡∏£‡∏≠‡πÅ‡∏Ç‡πà‡∏á' }
            ],
            unityHistory: [
                { id: 'unity1', date: '15 ‡∏°.‡∏Ñ. 2025', teamId: 'team2', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', score: 25, notes: '‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°' },
                { id: 'unity2', date: '15 ‡∏°.‡∏Ñ. 2025', teamId: 'team1', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á', score: 20, notes: '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏î‡∏µ' },
                { id: 'unity3', date: '14 ‡∏°.‡∏Ñ. 2025', teamId: 'team4', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', score: 23, notes: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô' },
                { id: 'unity4', date: '14 ‡∏°.‡∏Ñ. 2025', teamId: 'team3', teamName: '‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', score: 18, notes: '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' }
            ]
        };

        // Firebase initialization function (called when Firebase is ready)
        window.initializeFirebaseData = async function() {
            if (!window.db || !window.firestore) {
                console.log('Firebase not ready yet');
                return;
            }

            try {
                isFirebaseReady = true;
                updateFirebaseStatus(true);
                
                // Initialize collections with default data if they don't exist
                await initializeCollections();
                
                // Set up real-time listeners
                setupRealtimeListeners();
                
                console.log('Firebase initialized successfully');
            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateFirebaseStatus(false);
                isFirebaseReady = false;
            }
        };

        // Update Firebase status indicator
        function updateFirebaseStatus(connected) {
            const statusEl = document.getElementById('firebaseStatus');
            if (connected) {
                statusEl.className = 'firebase-status firebase-connected';
                statusEl.innerHTML = '<i class="fas fa-circle mr-1"></i>Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                statusEl.className = 'firebase-status firebase-disconnected';
                statusEl.innerHTML = '<i class="fas fa-circle mr-1"></i>Firebase ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            }
        }

        // Initialize Firebase collections with default data
        async function initializeCollections() {
            const { collection, getDocs, setDoc, doc } = window.firestore;
            
            try {
                // Check if collections exist, if not create them with default data
                const collections = ['sports', 'teams', 'schedule', 'unityHistory'];
                
                for (const collectionName of collections) {
                    const snapshot = await getDocs(collection(window.db, collectionName));
                    
                    if (snapshot.empty) {
                        console.log(`Initializing ${collectionName} collection`);
                        const data = localData[collectionName];
                        
                        for (const item of data) {
                            await setDoc(doc(window.db, collectionName, item.id), item);
                        }
                    }
                }
            } catch (error) {
                console.error('Error initializing collections:', error);
            }
        }

        // Set up real-time listeners for all collections
        function setupRealtimeListeners() {
            const { collection, onSnapshot } = window.firestore;
            
            // Listen to sports changes
            onSnapshot(collection(window.db, 'sports'), (snapshot) => {
                localData.sports = [];
                snapshot.forEach((doc) => {
                    localData.sports.push({ id: doc.id, ...doc.data() });
                });
                loadSportsData();
            });

            // Listen to teams changes
            onSnapshot(collection(window.db, 'teams'), (snapshot) => {
                localData.teams = [];
                snapshot.forEach((doc) => {
                    localData.teams.push({ id: doc.id, ...doc.data() });
                });
                loadTeamsData();
                loadScoreboardData();
                updateCharts();
            });

            // Listen to schedule changes
            onSnapshot(collection(window.db, 'schedule'), (snapshot) => {
                localData.schedule = [];
                snapshot.forEach((doc) => {
                    localData.schedule.push({ id: doc.id, ...doc.data() });
                });
                loadScheduleData();
            });

            // Listen to unity history changes
            onSnapshot(collection(window.db, 'unityHistory'), (snapshot) => {
                localData.unityHistory = [];
                snapshot.forEach((doc) => {
                    localData.unityHistory.push({ id: doc.id, ...doc.data() });
                });
                loadUnityData();
            });
        }

        // Firebase CRUD operations
        async function saveToFirebase(collectionName, data, docId = null) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, saving locally only');
                return;
            }

            try {
                const { collection, addDoc, setDoc, doc } = window.firestore;
                
                if (docId) {
                    await setDoc(doc(window.db, collectionName, docId), data);
                } else {
                    const docRef = await addDoc(collection(window.db, collectionName), data);
                    return docRef.id;
                }
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                throw error;
            }
        }

        async function updateFirebaseDoc(collectionName, docId, data) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, updating locally only');
                return;
            }

            try {
                const { updateDoc, doc } = window.firestore;
                await updateDoc(doc(window.db, collectionName, docId), data);
            } catch (error) {
                console.error('Error updating Firebase document:', error);
                throw error;
            }
        }

        async function deleteFromFirebase(collectionName, docId) {
            if (!isFirebaseReady) {
                console.log('Firebase not ready, deleting locally only');
                return;
            }

            try {
                const { deleteDoc, doc } = window.firestore;
                await deleteDoc(doc(window.db, collectionName, docId));
            } catch (error) {
                console.error('Error deleting from Firebase:', error);
                throw error;
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check credentials
            if (username === 'TUPPSC' && password === 'JetniphatInwza007naja') {
                userRole = 'admin';
                loginUser('Admin (TUPPSC)', '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
            } else {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    confirmButtonColor: '#3b82f6'
                });
            }
        });

        // Guest login functionality
        function guestLogin() {
            userRole = 'guest';
            loginUser('‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°', '‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß');
        }

        // Common login function
        function loginUser(displayName, roleText) {
            // Show loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            setTimeout(() => {
                // Hide login modal and show main app
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update current user display
                document.getElementById('currentUser').textContent = displayName;
                
                // Set user permissions
                setUserPermissions();
                
                // Initialize charts after login
                initCharts();
                
                // Load dynamic data
                loadSportsData();
                loadScheduleData();
                loadTeamsData();
                loadScoreboardData();
                loadUnityData();
                
                Swal.fire({
                    icon: 'success',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${roleText}`,
                    timer: 800,
                    showConfirmButton: false
                });
            }, 200);
        }

        // Set user permissions based on role
        function setUserPermissions() {
            const adminElements = document.querySelectorAll('.admin-only');
            const guestElements = document.querySelectorAll('.guest-only');
            
            if (userRole === 'admin') {
                // Show admin elements
                adminElements.forEach(el => {
                    el.style.display = '';
                });
                // Hide guest-only elements
                guestElements.forEach(el => {
                    el.style.display = 'none';
                });
            } else {
                // Hide admin elements
                adminElements.forEach(el => {
                    el.style.display = 'none';
                });
                // Show guest-only elements
                guestElements.forEach(el => {
                    el.style.display = '';
                });
            }
        }

        // Logout functionality
        function logout() {
            Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Reset user role
                    userRole = 'guest';
                    
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('loginModal').classList.remove('hidden');
                    
                    // Reset login form
                    document.getElementById('loginForm').reset();
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            });
        }

        // Initialize charts
        function initCharts() {
            const teams = [...localData.teams].sort((a, b) => b.totalScore - a.totalScore);
            
            // Score Chart
            const scoreCtx = document.getElementById('scoreChart').getContext('2d');
            if (charts.scoreChart) {
                charts.scoreChart.destroy();
            }
            charts.scoreChart = new Chart(scoreCtx, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°',
                        data: teams.map(team => team.totalScore),
                        backgroundColor: teams.map(team => team.color + '80'),
                        borderColor: teams.map(team => team.color),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });

            // Unity Chart
            const unityCtx = document.getElementById('unityChart').getContext('2d');
            if (charts.unityChart) {
                charts.unityChart.destroy();
            }
            charts.unityChart = new Chart(unityCtx, {
                type: 'radar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ',
                        data: teams.map(team => team.unityScore),
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });

            // Medal Chart
            const medalCtx = document.getElementById('medalChart').getContext('2d');
            if (charts.medalChart) {
                charts.medalChart.destroy();
            }
            charts.medalChart = new Chart(medalCtx, {
                type: 'doughnut',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        data: teams.map(team => team.gold + team.silver + team.bronze),
                        backgroundColor: teams.map(team => team.color + '80'),
                        borderColor: teams.map(team => team.color),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts() {
            if (Object.keys(charts).length > 0) {
                initCharts();
            }
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active-nav');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Add active class to clicked nav item
            event.target.classList.add('active-nav');
        }

        // Form submission
        document.getElementById('recordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Check if user has admin permission
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const formData = {
                sport: document.getElementById('sportSelect').value,
                round: document.getElementById('roundSelect').value,
                team1: document.getElementById('team1Select').value,
                score1: document.getElementById('score1').value,
                team2: document.getElementById('team2Select').value,
                score2: document.getElementById('score2').value,
                notes: document.getElementById('notes').value,
                timestamp: new Date().toISOString()
            };

            // Validate form
            if (!formData.sport || !formData.round || !formData.team1 || !formData.team2) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }

            if (formData.team1 === formData.team2) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }

            // Show loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                // Save to Firebase
                await saveToFirebase('matches', formData);
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#3b82f6'
                }).then(() => {
                    // Reset form
                    document.getElementById('recordForm').reset();
                });
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonColor: '#3b82f6'
                });
            }
        });

        // Load sports data
        function loadSportsData() {
            const sportsGrid = document.getElementById('sportsGrid');
            sportsGrid.innerHTML = '';
            
            localData.sports.forEach(sport => {
                const sportCard = document.createElement('div');
                sportCard.className = 'sport-card rounded-xl p-6 text-white card-hover';
                sportCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">${sport.name}</h3>
                        <div class="flex space-x-2 admin-only">
                            <button class="text-white/80 hover:text-white" onclick="editSport('${sport.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-white/80 hover:text-white" onclick="deleteSport('${sport.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-white/80 text-sm mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°: ${sport.teams} ‡∏ó‡∏µ‡∏°</p>
                    <p class="text-white/80 text-sm">‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô: ${sport.matches} ‡∏ô‡∏±‡∏î</p>
                `;
                sportsGrid.appendChild(sportCard);
            });
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Load schedule data
        function loadScheduleData() {
            const scheduleTable = document.getElementById('scheduleTable');
            scheduleTable.innerHTML = '';
            
            localData.schedule.forEach(match => {
                const row = document.createElement('tr');
                row.className = 'border-b border-white/10';
                
                let statusClass = 'bg-gray-500';
                if (match.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') statusClass = 'bg-green-500';
                else if (match.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Ç‡πà‡∏á') statusClass = 'bg-yellow-500';
                else if (match.status === '‡∏£‡∏≠‡πÅ‡∏Ç‡πà‡∏á') statusClass = 'bg-blue-500';
                
                row.innerHTML = `
                    <td class="py-4 px-4">${match.date}</td>
                    <td class="py-4 px-4">${match.time}</td>
                    <td class="py-4 px-4">${match.sport}</td>
                    <td class="py-4 px-4">${match.match}</td>
                    <td class="py-4 px-4">${match.venue}</td>
                    <td class="py-4 px-4 text-center">
                        <span class="${statusClass} text-white px-3 py-1 rounded-full text-sm">${match.status}</span>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="admin-only">
                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editSchedule('${match.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-400 hover:text-red-300" onclick="deleteSchedule('${match.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="guest-only">
                            <span class="text-white/50 text-sm">-</span>
                        </div>
                    </td>
                `;
                scheduleTable.appendChild(row);
            });
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Load teams data
        function loadTeamsData() {
            const teamsGrid = document.getElementById('teamsGrid');
            teamsGrid.innerHTML = '';
            
            localData.teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'bg-white/20 backdrop-blur-md rounded-xl p-6 card-hover';
                teamCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-6 h-6 rounded-full mr-3" style="background-color: ${team.color}"></div>
                            <h3 class="text-xl font-bold text-white">${team.name}</h3>
                        </div>
                        <div class="flex space-x-2 admin-only">
                            <button class="text-white/80 hover:text-white" onclick="editTeam('${team.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-white/80 hover:text-white" onclick="deleteTeam('${team.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-white/80 text-sm">
                        <div>
                            <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤: <span class="font-bold text-white">${team.sportsScore}</span></p>
                            <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ: <span class="font-bold text-white">${team.unityScore}</span></p>
                        </div>
                        <div>
                            <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span class="font-bold text-white text-lg">${team.totalScore}</span></p>
                            <p>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: <span class="font-bold text-white">${team.gold + team.silver + team.bronze}</span></p>
                        </div>
                    </div>
                `;
                teamsGrid.appendChild(teamCard);
            });
            
            // Update team select options
            updateTeamSelects();
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Load scoreboard data
        function loadScoreboardData() {
            const scoreboardTable = document.getElementById('scoreboardTable');
            scoreboardTable.innerHTML = '';
            
            const sortedTeams = [...localData.teams].sort((a, b) => b.totalScore - a.totalScore);
            
            sortedTeams.forEach((team, index) => {
                const row = document.createElement('tr');
                row.className = `border-b border-white/10 ${index === 0 ? 'bg-gradient-to-r from-yellow-500/20 to-yellow-600/20' : ''}`;
                
                row.innerHTML = `
                    <td class="py-4 px-4 font-bold">${index + 1}</td>
                    <td class="py-4 px-4">
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-3" style="background-color: ${team.color}"></div>
                            ${team.name}
                        </div>
                    </td>
                    <td class="py-4 px-4 text-center font-bold">${team.sportsScore}</td>
                    <td class="py-4 px-4 text-center font-bold">${team.unityScore}</td>
                    <td class="py-4 px-4 text-center font-bold text-2xl">${team.totalScore}</td>
                    <td class="py-4 px-4 text-center font-bold">${team.gold}</td>
                    <td class="py-4 px-4 text-center font-bold">${team.silver}</td>
                    <td class="py-4 px-4 text-center font-bold">${team.bronze}</td>
                `;
                scoreboardTable.appendChild(row);
            });
        }

        // Load unity data
        function loadUnityData() {
            const unityHistoryTable = document.getElementById('unityHistoryTable');
            unityHistoryTable.innerHTML = '';
            
            localData.unityHistory.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'border-b border-white/10';
                
                row.innerHTML = `
                    <td class="py-3 px-4">${record.date}</td>
                    <td class="py-3 px-4">${record.teamName}</td>
                    <td class="py-3 px-4 text-center font-bold">${record.score}</td>
                    <td class="py-3 px-4">${record.notes}</td>
                    <td class="py-3 px-4 text-center">
                        <div class="admin-only">
                            <button class="text-red-400 hover:text-red-300" onclick="deleteUnityRecord('${record.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="guest-only">
                            <span class="text-white/50 text-sm">-</span>
                        </div>
                    </td>
                `;
                unityHistoryTable.appendChild(row);
            });
            
            // Update permissions after loading
            setUserPermissions();
        }

        // Update team select options
        function updateTeamSelects() {
            const selects = ['team1Select', 'team2Select', 'unityTeamSelect'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Keep the first option
                    const firstOption = select.querySelector('option');
                    select.innerHTML = '';
                    select.appendChild(firstOption);
                    
                    // Add team options
                    localData.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = team.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Edit sport function
        async function editSport(sportId) {
            if (userRole !== 'admin') return;
            
            const sport = localData.sports.find(s => s.id === sportId);
            if (!sport) return;
            
            const { value: formValues } = await Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤',
                html: `
                    <div class="grid grid-cols-1 gap-4 text-left">
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡∏¨‡∏≤</label>
                            <input type="text" id="editSportName" class="w-full px-3 py-2 border rounded-lg" value="${sport.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</label>
                            <input type="number" id="editTeamCount" class="w-full px-3 py-2 border rounded-lg" value="${sport.teams}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                            <input type="number" id="editMatchCount" class="w-full px-3 py-2 border rounded-lg" value="${sport.matches}">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                preConfirm: () => {
                    const name = document.getElementById('editSportName').value;
                    const teams = parseInt(document.getElementById('editTeamCount').value);
                    const matches = parseInt(document.getElementById('editMatchCount').value);
                    
                    if (!name || !teams || !matches) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, teams, matches };
                }
            });

            if (formValues) {
                try {
                    await updateFirebaseDoc('sports', sportId, formValues);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Delete sport function
        async function deleteSport(sportId) {
            if (userRole !== 'admin') return;
            
            const sport = localData.sports.find(s => s.id === sportId);
            if (!sport) return;
            
            const result = await Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤?',
                text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${sport.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    await deleteFromFirebase('sports', sportId);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Unity form submission
        document.getElementById('unityForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const teamId = document.getElementById('unityTeamSelect').value;
            const score = parseInt(document.getElementById('unityScore').value);
            const notes = document.getElementById('unityNotes').value;
            
            if (!teamId || score === null || score === undefined) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            if (score < 0 || score > 100) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0-100',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            // Find team
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            try {
                // Create unity record
                const unityRecord = {
                    date: new Date().toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' }),
                    teamId: teamId,
                    teamName: team.name,
                    score: score,
                    notes: notes || '-',
                    timestamp: new Date().toISOString()
                };
                
                // Save unity record
                const recordId = await saveToFirebase('unityHistory', unityRecord);
                
                // Update team scores
                const updatedTeam = {
                    ...team,
                    unityScore: team.unityScore + score,
                    totalScore: team.sportsScore + team.unityScore + score
                };
                
                await updateFirebaseDoc('teams', teamId, updatedTeam);
                
                // Clear form
                clearUnityForm();
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ ${team.name} ‡πÅ‡∏•‡πâ‡∏ß`,
                    confirmButtonColor: '#3b82f6'
                });
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
            }
        });

        // Clear unity form
        function clearUnityForm() {
            document.getElementById('unityTeamSelect').value = '';
            document.getElementById('unityScore').value = '';
            document.getElementById('unityNotes').value = '';
        }

        // Delete unity record
        async function deleteUnityRecord(recordId) {
            if (userRole !== 'admin') return;
            
            const record = localData.unityHistory.find(r => r.id === recordId);
            if (!record) return;
            
            const result = await Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?',
                text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ${record.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á ${record.teamName} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Find team and subtract score
                    const team = localData.teams.find(t => t.id === record.teamId);
                    if (team) {
                        const updatedTeam = {
                            ...team,
                            unityScore: team.unityScore - record.score,
                            totalScore: team.sportsScore + team.unityScore - record.score
                        };
                        
                        await updateFirebaseDoc('teams', record.teamId, updatedTeam);
                    }
                    
                    // Delete unity record
                    await deleteFromFirebase('unityHistory', recordId);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Team management functions
        async function showAddTeamModal() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            const { value: formValues } = await Swal.fire({
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà',
                html: `
                    <div class="grid grid-cols-1 gap-4 text-left">
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                            <input type="text" id="modalTeamName" class="w-full px-3 py-2 border rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏ì‡∏∞</label>
                            <input type="color" id="modalTeamColor" class="w-full px-3 py-2 border rounded-lg" value="#8b5cf6">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡πÄ‡∏û‡∏¥‡πà‡∏°',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                preConfirm: () => {
                    const name = document.getElementById('modalTeamName').value;
                    const color = document.getElementById('modalTeamColor').value;
                    
                    if (!name || !color) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, color };
                }
            });

            if (formValues) {
                try {
                    const newTeam = {
                        name: formValues.name,
                        color: formValues.color,
                        sportsScore: 0,
                        unityScore: 0,
                        totalScore: 0,
                        gold: 0,
                        silver: 0,
                        bronze: 0,
                        timestamp: new Date().toISOString()
                    };
                    
                    await saveToFirebase('teams', newTeam);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        async function editTeam(teamId) {
            if (userRole !== 'admin') return;
            
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const { value: formValues } = await Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ',
                html: `
                    <div class="grid grid-cols-1 gap-4 text-left">
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</label>
                            <input type="text" id="editTeamName" class="w-full px-3 py-2 border rounded-lg" value="${team.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏ì‡∏∞</label>
                            <input type="color" id="editTeamColor" class="w-full px-3 py-2 border rounded-lg" value="${team.color}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤</label>
                            <input type="number" id="editSportsScore" class="w-full px-3 py-2 border rounded-lg" value="${team.sportsScore}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏≠‡∏á</label>
                            <input type="number" id="editGold" class="w-full px-3 py-2 border rounded-lg" value="${team.gold}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <input type="number" id="editSilver" class="w-full px-3 py-2 border rounded-lg" value="${team.silver}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á</label>
                            <input type="number" id="editBronze" class="w-full px-3 py-2 border rounded-lg" value="${team.bronze}">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                preConfirm: () => {
                    const name = document.getElementById('editTeamName').value;
                    const color = document.getElementById('editTeamColor').value;
                    const sportsScore = parseInt(document.getElementById('editSportsScore').value) || 0;
                    const gold = parseInt(document.getElementById('editGold').value) || 0;
                    const silver = parseInt(document.getElementById('editSilver').value) || 0;
                    const bronze = parseInt(document.getElementById('editBronze').value) || 0;
                    
                    if (!name || !color) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, color, sportsScore, gold, silver, bronze };
                }
            });

            if (formValues) {
                try {
                    const updatedTeam = {
                        ...team,
                        ...formValues,
                        totalScore: formValues.sportsScore + team.unityScore
                    };
                    
                    await updateFirebaseDoc('teams', teamId, updatedTeam);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        async function deleteTeam(teamId) {
            if (userRole !== 'admin') return;
            
            const team = localData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const result = await Swal.fire({
                title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ?',
                text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${team.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Delete team
                    await deleteFromFirebase('teams', teamId);
                    
                    // Delete related unity history
                    const relatedRecords = localData.unityHistory.filter(r => r.teamId === teamId);
                    for (const record of relatedRecords) {
                        await deleteFromFirebase('unityHistory', record.id);
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        confirmButtonColor: '#3b82f6'
                    });
                }
            }
        }

        // Export functions (placeholder)
        function exportPDF() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#3b82f6'
                });
            }, 2000);
        }

        function exportExcel() {
            if (userRole !== 'admin') {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#3b82f6'
                });
            }, 2000);
        }

        // Placeholder functions for missing features
        function showAddScheduleModal() {
            Swal.fire({
                icon: 'info',
                title: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                confirmButtonColor: '#3b82f6'
            });
        }

        function showAddSportModal() {
            Swal.fire({
                icon: 'info',
                title: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                confirmButtonColor: '#3b82f6'
            });
        }

        function editSchedule(scheduleId) {
            if (userRole !== 'admin') return;
            Swal.fire({
                icon: 'info',
                title: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                confirmButtonColor: '#3b82f6'
            });
        }

        function deleteSchedule(scheduleId) {
            if (userRole !== 'admin') return;
            Swal.fire({
                icon: 'info',
                title: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                confirmButtonColor: '#3b82f6'
            });
        }

        // Initialize on page load
        $(document).ready(function() {
            // Set current time
            const now = new Date();
            document.getElementById('loginTime').textContent = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            }) + ' ‡∏ô.';
            
            // Initialize Firebase status as disconnected
            updateFirebaseStatus(false);
            
            // Try to initialize Firebase data if already ready
            if (window.db && window.firestore) {
                window.initializeFirebaseData();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98659054803f7b6a',t:'MTc1OTA4Njg2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
